<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Base Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple focus style for better accessibility */
        input:focus {
            box-shadow: 0 0 0 2px #60a5fa; /* blue-400 */
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen">

    <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-2xl mx-4">
        
        <h1 class="text-3xl font-bold text-center text-white mb-2">Number Base Converter</h1>
        <p class="text-center text-gray-400 mb-8">Convert between Decimal, Hexadecimal, Binary, and Octal.</p>

        <div class="grid grid-cols-1 gap-6">
            <!-- Signed Checkbox -->
            <div class="flex items-center mb-2">
                <input id="signed" type="checkbox" class="mr-2 accent-blue-500 w-5 h-5">
                <label for="signed" class="text-gray-300 text-sm font-medium select-none cursor-pointer">Signed</label>
            </div>
            <!-- Hexadecimal Input -->
            <div>
                <label for="hexadecimal" class="block mb-2 text-sm font-medium text-gray-300">Hexadecimal</label>
                <input type="text" id="hexadecimal" class="bg-gray-700 border-0 text-white text-lg rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-4 outline-none" placeholder="e.g., ff">
            </div>

            <!-- Decimal Input -->
            <div>
                <label for="decimal" class="block mb-2 text-sm font-medium text-gray-300">Decimal</label>
                <input type="text" id="decimal" class="bg-gray-700 border-0 text-white text-lg rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-4 outline-none" placeholder="e.g., 255">
            </div>

            <!-- Octal Input -->
            <div>
                <label for="octal" class="block mb-2 text-sm font-medium text-gray-300">Octal</label>
                <input type="text" id="octal" class="bg-gray-700 border-0 text-white text-lg rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-4 outline-none" placeholder="e.g., 377">
            </div>

            <!-- Binary Input -->
            <div>
                <label for="binary" class="block mb-2 text-sm font-medium text-gray-300">Binary</label>
                <div id="binary-bits" class="flex flex-col gap-1 mb-4"></div>
                <input type="text" id="binary" class="hidden" autocomplete="off">
            </div>
        </div>

    </div>

    <script>
    const decimalInput = document.getElementById('decimal');
    const hexadecimalInput = document.getElementById('hexadecimal');
    const binaryInput = document.getElementById('binary');
    const octalInput = document.getElementById('octal');
    const binaryBitsDiv = document.getElementById('binary-bits');
    const signedCheckbox = document.getElementById('signed');

    const inputs = [decimalInput, hexadecimalInput, binaryInput, octalInput];

    // Helper to pad binary string to 64 bits
    function padBinary(bin, length = 64) {
        return bin.padStart(length, '0');
    }

    // Helper to group binary string by 4 bits
    function groupBinary(binStr) {
        let groups = [];
        for (let i = 0; i < binStr.length; i += 4) {
            groups.push(binStr.slice(i, i + 4));
        }
        return groups;
    }

    // Render clickable binary bits, 2 lines of 32 bits, grouped by 4
    function renderBinaryBits(binStr) {
        // Always use 64 bits for display
        binStr = padBinary(binStr, 64).slice(-64);
        binaryBitsDiv.innerHTML = '';
        const groups = groupBinary(binStr);
        for (let line = 0; line < 2; line++) {
            const lineDiv = document.createElement('div');
            lineDiv.className = 'flex gap-1';
            for (let g = 0; g < 8; g++) {
                const groupIdx = line * 8 + g;
                const group = groups[groupIdx] || '0000';
                const groupDiv = document.createElement('div');
                groupDiv.className = 'flex gap-0.5';
                for (let b = 0; b < 4; b++) {
                    const bitIdx = groupIdx * 4 + b;
                    const bit = group[b] || '0';
                    const span = document.createElement('span');
                    span.textContent = bit;
                    span.className = `cursor-pointer select-none px-0.5 py-0.5 rounded text-sm font-mono font-bold transition
                        ${bit === '1' ? 'bg-blue-500 text-white' : 'bg-gray-600 text-gray-200'} hover:ring-2 hover:ring-blue-400`;
                    span.style.minWidth = '1em';
                    span.dataset.index = bitIdx;
                    span.addEventListener('click', () => {
                        let bitsArr = binStr.split('');
                        bitsArr[bitIdx] = bitsArr[bitIdx] === '1' ? '0' : '1';
                        let newBin = bitsArr.join('');
                        binaryInput.value = newBin.replace(/^0+/, '') || '0';
                        updateValues('binary', newBin);
                    });
                    groupDiv.appendChild(span);
                }
                lineDiv.appendChild(groupDiv);
            }
            binaryBitsDiv.appendChild(lineDiv);
        }
    }

    // Add event listener to all input fields except binary (handled separately)
    [decimalInput, hexadecimalInput, octalInput].forEach(input => {
        input.addEventListener('input', (e) => {
            const sourceInput = e.target;
            const sourceValue = sourceInput.value;
            if (sourceValue === '') {
                clearAllInputs();
                renderBinaryBits('0');
                return;
            }
            updateValues(sourceInput.id, sourceValue);
        });
    });

    // Binary input (hidden) triggers recalculation and bits rendering
    binaryInput.addEventListener('input', (e) => {
        const val = e.target.value.replace(/[^01]/g, '');
        binaryInput.value = val;
        if (val === '') {
            clearAllInputs();
            renderBinaryBits('0');
            return;
        }
        updateValues('binary', val);
    });

    // Signed checkbox triggers recalculation
    signedCheckbox.addEventListener('change', () => {
        let binVal = binaryInput.value || '0';
        updateValues('binary', binVal);
    });

    // Initial render
    renderBinaryBits('0');

    function updateValues(sourceId, sourceValue) {
        let decimalValue;
        let binStr = '';
        let isSigned = signedCheckbox.checked;

        try {
            switch (sourceId) {
                case 'decimal':
                    if (/^-?\d+$/.test(sourceValue)) {
                        let num = BigInt(sourceValue);
                        if (isSigned) {
                            if (num < -(2n ** 63n)) num = -(2n ** 63n);
                            if (num > (2n ** 63n - 1n)) num = 2n ** 63n - 1n;
                            decimalValue = num;
                            binStr = (num < 0 ? (num + 2n ** 64n) : num).toString(2);
                        } else {
                            if (num < 0n) num = 0n;
                            if (num > (2n ** 64n - 1n)) num = 2n ** 64n - 1n;
                            decimalValue = num;
                            binStr = num.toString(2);
                        }
                    }
                    break;
                case 'hexadecimal':
                    if (/^[0-9a-fA-F]+$/.test(sourceValue)) {
                        let num = BigInt('0x' + sourceValue);
                        if (isSigned && num >= 2n ** 63n) {
                            decimalValue = num - 2n ** 64n;
                        } else {
                            decimalValue = num;
                        }
                        binStr = num.toString(2);
                    }
                    break;
                case 'binary':
                    if (/^[01]+$/.test(sourceValue)) {
                        let num = BigInt('0b' + padBinary(sourceValue, 64).slice(-64));
                        if (isSigned && sourceValue.length === 64 && sourceValue[0] === '1') {
                            decimalValue = num - 2n ** 64n;
                        } else {
                            decimalValue = num;
                        }
                        binStr = num.toString(2);
                    }
                    break;
                case 'octal':
                    if (/^[0-7]+$/.test(sourceValue)) {
                        let num = BigInt('0o' + sourceValue);
                        if (isSigned && num >= 2n ** 63n) {
                            decimalValue = num - 2n ** 64n;
                        } else {
                            decimalValue = num;
                        }
                        binStr = num.toString(2);
                    }
                    break;
            }
        } catch (e) {
            decimalValue = undefined;
        }

        if (typeof decimalValue !== 'undefined' && decimalValue !== null) {
            binStr = padBinary(binStr, 64).slice(-64);

            if (sourceId !== 'decimal') decimalInput.value = decimalValue.toString();
            if (sourceId !== 'hexadecimal') hexadecimalInput.value = BigInt('0b' + binStr).toString(16).toLowerCase();
            if (sourceId !== 'binary') {
                binaryInput.value = binStr.replace(/^0+/, '') || '0';
                renderBinaryBits(binStr);
            } else {
                renderBinaryBits(binStr);
            }
            if (sourceId !== 'octal') octalInput.value = BigInt('0b' + binStr).toString(8);
        } else {
            clearAllInputs(sourceId);
            renderBinaryBits('0'.repeat(64));
        }
    }

    function clearAllInputs(skipId = null) {
        inputs.forEach(input => {
            if (input.id !== skipId) {
                input.value = '';
            }
        });
    }
    </script>
</body>
</html>

